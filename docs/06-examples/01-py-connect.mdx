# Basic Python example of how to connect to server

```py
from ctrader_open_api import Client, Protobuf, TcpProtocol, EndPoints
import ctrader_open_api.messages.OpenApiMessages_pb2 as OA
import ctrader_open_api.messages.OpenApiModelMessages_pb2 as OAModel
import ctrader_open_api.messages.OpenApiCommonMessages_pb2 as OACommon
import ctrader_open_api.messages.OpenApiCommonModelMessages_pb2 as OAModelCommon
from twisted.internet import reactor

# connection, authentication and program lifecycle
import json

credentials = json.load(open('credentials.json'))
client = Client(EndPoints.PROTOBUF_DEMO_HOST, EndPoints.PROTOBUF_PORT, TcpProtocol)

def main():
  print('ready to do something')
  reactor.stop()

def onAccAuth(message):
  print('account authenticated')
  main()

def onAppAuth(message):
  print('app authenticated')
  req = OA.ProtoOAAccountAuthReq()
  req.ctidTraderAccountId = credentials['accountId']
  req.accessToken = credentials['accessToken']
  deferred = client.send(req)
  deferred.addCallbacks(onAccAuth, onError)

def onError(failure):
  print('err: ', repr(failure.value))

def connected(client):
  print('connected')
  req = OA.ProtoOAApplicationAuthReq()
  req.clientId = credentials['clientId']
  req.clientSecret = credentials['clientSecret']
  deferred = client.send(req, responseTimeoutInSeconds=20) # err if no response under 20 secs
  deferred.addCallbacks(onAppAuth, onError)

def disconnected(client, reason):
  print('disconnected: ', reason)

def onMsg(client, message):
  ignores = [i.payloadType for i in [OACommon.ProtoHeartbeatEvent(),
                                     OA.ProtoOAAccountAuthRes(),
                                     OA.ProtoOAApplicationAuthRes()]]
  if message.payloadType in ignores:
    return
  print('message received')

client.setConnectedCallback(connected)
client.setDisconnectedCallback(disconnected)
client.setMessageReceivedCallback(onMsg)
client.startService()
reactor.run()

```
