"use strict";(self.webpackChunkctrader_openapi_docs=self.webpackChunkctrader_openapi_docs||[]).push([[426],{5326:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"contacting-api/protobuf/compiler-and-runtime","title":"Compiler and Runtime","description":"In order to use Protobuf format, we need three things:","source":"@site/i18n/fa/docusaurus-plugin-content-docs/current/02-contacting-api/07-protobuf/01-compiler-and-runtime.mdx","sourceDirName":"02-contacting-api/07-protobuf","slug":"/contacting-api/protobuf/compiler-and-runtime","permalink":"/ctoa/fa/contacting-api/protobuf/compiler-and-runtime","draft":false,"unlisted":false,"editUrl":"https://github.com/m-ahmadi/ctoa/blob/main/docs/02-contacting-api/07-protobuf/01-compiler-and-runtime.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"Protobuf","permalink":"/ctoa/fa/contacting-api/protobuf/"},"next":{"title":"Compilation of .proto Files","permalink":"/ctoa/fa/contacting-api/protobuf/compilation-of-proto-files"}}');var o=t(4848),i=t(8453),s=t(5537),a=t(9329);const l={},c="Compiler and Runtime",d={},u=[{value:"Compiler",id:"compiler",level:2},{value:"Install Main Compiler",id:"install-main-compiler",level:3},{value:"Install JavaScript-Specific Compiler",id:"install-javascript-specific-compiler",level:3},{value:"Runtime",id:"runtime",level:2},{value:"Compiler and Runtime Versions",id:"compiler-and-runtime-versions",level:2},{value:"How to Check If Your Runtime is Ok with GenCode",id:"how-to-check-if-your-runtime-is-ok-with-gencode",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"compiler-and-runtime",children:"Compiler and Runtime"})}),"\n",(0,o.jsx)(n.p,{children:"In order to use Protobuf format, we need three things:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["The source ",(0,o.jsx)(n.code,{children:".proto"})," files."]}),"\n",(0,o.jsx)(n.li,{children:"A compiler that compiles the source files."}),"\n",(0,o.jsx)(n.li,{children:"A runtime that loads the compiled files."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"compiler",children:"Compiler"}),"\n",(0,o.jsxs)(n.p,{children:["There is a\n",(0,o.jsx)(n.a,{href:"https://github.com/protocolbuffers/protobuf/releases/",children:"main compiler"})," that can\ncompile ",(0,o.jsx)(n.code,{children:".proto"})," files into ",(0,o.jsx)(n.code,{children:"Python"}),", ",(0,o.jsx)(n.code,{children:"Go"}),", ",(0,o.jsx)(n.code,{children:"Rust"}),", ",(0,o.jsx)(n.code,{children:"C#"}),", ",(0,o.jsx)(n.code,{children:"Java"})," and ",(0,o.jsx)(n.code,{children:"C++"}),". Once\ninstalled its command is ",(0,o.jsx)(n.code,{children:"protoc"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["For ",(0,o.jsx)(n.code,{children:"JavaScript"}),", we have two options:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.npmjs.com/package/google-protobuf",children:(0,o.jsx)(n.code,{children:"google-protobuf"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"This is the official way."}),"\n",(0,o.jsxs)(n.li,{children:["Requires a build of the ",(0,o.jsx)(n.code,{children:"protoc"})," source, with some modifications so the\n",(0,o.jsx)(n.code,{children:"protoc"})," command will become capable of compiling into JavaScript output."]}),"\n",(0,o.jsxs)(n.li,{children:["Once installed its command is the same ",(0,o.jsx)(n.code,{children:"protoc"})," as before but with a new\n",(0,o.jsx)(n.code,{children:"--js-out"})," option available."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.npmjs.com/package/protobufjs",children:(0,o.jsx)(n.code,{children:"protobufjs"})})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"This is a 3rd-party package."}),"\n",(0,o.jsx)(n.li,{children:"Requires no extra step."}),"\n",(0,o.jsxs)(n.li,{children:["Once installed, its command is ",(0,o.jsx)(n.code,{children:"pbjs"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"We will move forward with the option 2, mainly because it's simpler and requires\nless explanation."}),"\n",(0,o.jsx)(n.h3,{id:"install-main-compiler",children:"Install Main Compiler"}),"\n",(0,o.jsxs)(s.A,{children:[(0,o.jsxs)(a.A,{value:"Windows",children:[(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"winget install protobuf\nprotoc --version # libprotoc 31.1\n"})}),(0,o.jsx)(n.admonition,{title:"Manual install",type:"tip",children:(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Go to\n",(0,o.jsx)(n.a,{href:"https://github.com/protocolbuffers/protobuf/releases",children:'"Releases" page of the compiler\'s Github repository'}),"."]}),"\n",(0,o.jsxs)(n.li,{children:['Under "Assets", download the ',(0,o.jsx)(n.code,{children:"protoc-31.1-win64.zip"})," file."]}),"\n",(0,o.jsxs)(n.li,{children:["Extract the zip file into for example the ",(0,o.jsx)(n.code,{children:"C:\\protoc-31.1-win64"})," directory."]}),"\n",(0,o.jsxs)(n.li,{children:["Add the path to the extracted files to your computer's path variable.","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Press ",(0,o.jsx)(n.code,{children:"win + r"})," keys."]}),"\n",(0,o.jsxs)(n.li,{children:["Type ",(0,o.jsx)(n.code,{children:"rundll32.exe sysdm.cpl,EditEnvironmentVariables"})]}),"\n",(0,o.jsxs)(n.li,{children:["Under ",(0,o.jsx)(n.code,{children:"User Variables"}),", select ",(0,o.jsx)(n.code,{children:"Path"})," and click ",(0,o.jsx)(n.code,{children:"Edit"})," button, and in\nopened form click ",(0,o.jsx)(n.code,{children:"Add"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Put ",(0,o.jsx)(n.code,{children:"C:\\protoc-31.1-win64\\bin"}),", and click ",(0,o.jsx)(n.code,{children:"OK"}),", and another ",(0,o.jsx)(n.code,{children:"OK"}),"."]}),"\n"]}),"\n"]}),"\n"]})})]}),(0,o.jsxs)(a.A,{value:"Linux",children:[(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"apt install protobuf-compiler -y\nprotoc --version # libprotoc 31.1\n"})}),(0,o.jsxs)(n.admonition,{title:"Manual install",type:"tip",children:[(0,o.jsxs)(n.p,{children:["Download the distribution matching your operating system from\n",(0,o.jsx)(n.a,{href:"https://github.com/protocolbuffers/protobuf/releases",children:"the compiler's repo"})," and\nadd it to path."]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'cd ~\nwget https://github.com/protocolbuffers/protobuf/releases/download/v31.1/protoc-31.1-linux-x86_64.zip\nunzip protoc-31.1-linux-x86_64.zip -d protoc\nsudo chmod a+x ~/protoc/bin/protoc\nnano .profile # in opened editor, add below line, save and exit\nexport PATH="$PATH:$HOME/protoc/bin/"\nsource .profile\n'})})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"install-javascript-specific-compiler",children:"Install JavaScript-Specific Compiler"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm install protobufjs -g\npbjs\n"})}),"\n",(0,o.jsx)(n.h2,{id:"runtime",children:"Runtime"}),"\n",(0,o.jsx)(n.p,{children:"To load and use the compiled files in our code, we need to install the Protobuf\nruntime in our programming language environment, which is in the form of a\nlibrary or package."}),"\n",(0,o.jsxs)(s.A,{children:[(0,o.jsx)(a.A,{value:"JavaScript",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"npm i protobufjs\npbjs # to check version\n\n# protobuf.js v1.1.3 CLI for JavaScript\n# ...\n"})})}),(0,o.jsx)(a.A,{value:"Python",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"pip install protobuf\npip show protobuf # to check version\n\n# Version: 6.31.1 ...\n# ...\n"})})})]}),"\n",(0,o.jsx)(n.h2,{id:"compiler-and-runtime-versions",children:"Compiler and Runtime Versions"}),"\n",(0,o.jsxs)(n.p,{children:["When working with Protobuf, there is a concept called\n",(0,o.jsx)(n.a,{href:"https://protobuf.dev/support/cross-version-runtime-guarantee/",children:"Cross-Version Runtime"}),'.\nIt simply means you cannot just use any version of the compiler with any version\nof the runtime will\u063a-nilly. The output of the compiler is called "Generated\nCode" or GenCode for short. The runtime has to be able to load this GenCode.']}),"\n",(0,o.jsx)(n.p,{children:"The compiler and the runtime have their own versions. You can think of the\ncompiler as the one who writes some things, and the runtime as the one that has\nto read what's been written. Now imagine the writer in a newer version, writes\nin a way that only the reader of the same version can understand it."}),"\n",(0,o.jsxs)(n.p,{children:["Here is the\n",(0,o.jsx)(n.a,{href:"https://protobuf.dev/support/cross-version-runtime-guarantee/",children:"officiall recommandation"}),"\nof the Protobuf itself. Altough you can get away with a new runtime and old\nGenCode, The simplest approach is to match both of their versions to a specific\npublish date. The below Node.js scripts shows how to find proper compiler\nversion for a runtime."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"// `protoc`\n\nurl =\n  'https://api.github.com/repos/protocolbuffers/protobuf/releases?per_page=100&page=1';\nr = await (await fetch(url)).json();\na = r.map((i) => [i.tag_name, i.published_at]);\n\n// `protobuf` pypi pkg\nurl = 'https://pypi.org/pypi/protobuf/json';\nr = await (await fetch(url)).json();\nb = Object.keys(r.releases).map((k) => [k, r.releases[k][0].upload_time]);\n\n// find out proper compiler version for `protobuf` pypi pkg 3.20.1 (for example)\nb.find((i) => i[0] === '3.20.1'); // ['3.20.1', '2022-04-22T02:03:01']   py pkg ver\na.find((i) => i[1].includes('2022-04')); // ['v3.20.1', '2022-04-22T02:27:33Z'] proper compiler ver\n"})}),"\n",(0,o.jsx)(n.p,{children:"that you shouldn't mix two different versions of them. There are cases that you\ncan get away with mixing two different versions, but it's best to avoid it\naltogether, and we will introduce the proper way to make sure of that."}),"\n",(0,o.jsx)(n.h3,{id:"how-to-check-if-your-runtime-is-ok-with-gencode",children:"How to Check If Your Runtime is Ok with GenCode"}),"\n",(0,o.jsxs)(n.p,{children:["In the Python case, you should compile your ",(0,o.jsx)(n.code,{children:".proto"})," files, and then try to\nimport them in a script (that's it, just import them and nothing else), then try\nto run the script. If there exists a version mismatch, you will see proper\nwarnings that say as such. If you don't see any warning, that means you have\ndone everything correctly."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},5537:(e,n,t)=>{t.d(n,{A:()=>y});var r=t(6540),o=t(4164),i=t(5627),s=t(6347),a=t(372),l=t(604),c=t(1861),d=t(8749);function u(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r}))}(t);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const t=(0,s.W6)(),o=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(o),(0,r.useCallback)(e=>{if(!o)return;const n=new URLSearchParams(t.location.search);n.set(o,e),t.replace({...t.location,search:n.toString()})},[o,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,i=h(e),[s,l]=(0,r.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i})),[c,u]=m({queryString:t,groupId:o}),[f,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,o]=(0,d.Dv)(n);return[t,(0,r.useCallback)(e=>{n&&o.set(e)},[n,o])]}({groupId:o}),x=(()=>{const e=c??f;return p({value:e,tabValues:i})?e:null})();(0,a.A)(()=>{x&&l(x)},[x]);return{selectedValue:s,selectValue:(0,r.useCallback)(e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),b(e)},[u,b,i]),tabValues:i}}var b=t(9136);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=t(4848);function v({className:e,block:n,selectedValue:t,selectValue:r,tabValues:s}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),c=e=>{const n=e.currentTarget,o=a.indexOf(n),i=s[o].value;i!==t&&(l(n),r(i))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{const t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":n},e),children:s.map(({value:e,label:n,attributes:r})=>(0,j.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:c,...r,className:(0,o.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function w({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===t);return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function g(e){const n=f(e);return(0,j.jsxs)("div",{className:(0,o.A)("tabs-container",x.tabList),children:[(0,j.jsx)(v,{...n,...e}),(0,j.jsx)(w,{...n,...e})]})}function y(e){const n=(0,b.A)();return(0,j.jsx)(g,{...e,children:u(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var r=t(6540);const o={},i=r.createContext(o);function s(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:n},e.children)}},9329:(e,n,t)=>{t.d(n,{A:()=>s});t(6540);var r=t(4164);const o={tabItem:"tabItem_Ymn6"};var i=t(4848);function s({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.tabItem,t),hidden:n,children:e})}}}]);