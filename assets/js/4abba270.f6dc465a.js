"use strict";(self.webpackChunkctrader_openapi_docs=self.webpackChunkctrader_openapi_docs||[]).push([[26],{25:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>s,contentTitle:()=>r,default:()=>l,frontMatter:()=>i,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"contacting-api/authentication","title":"Authentication","description":"Results from running the code:","source":"@site/docs/02-contacting-api/05-authentication.mdx","sourceDirName":"02-contacting-api","slug":"/contacting-api/authentication","permalink":"/ctoa/contacting-api/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/m-ahmadi/ctoa/blob/main/docs/02-contacting-api/05-authentication.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"Acquiring Credentials","permalink":"/ctoa/contacting-api/acquiring-credentials"},"next":{"title":"Keeping Connection Open","permalink":"/ctoa/contacting-api/keeping-connection-open"}}');var a=t(4848),c=t(8453);const i={},r="Authentication",s={},d=[];function u(n){const e={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,c.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-js",children:"const {\n  clientId,\n  clientSecret,\n  accountId: ctidTraderAccountId,\n  accessToken,\n} = require('./credentials.json');\n\nconst ws = new WebSocket('wss://live.ctraderapi.com:5036');\n\n// util functions\nconst { log } = console;\nconst sleep = (secs) => new Promise((r) => setTimeout(r, secs * 1000));\n\nconst CHECK_INTERVAL_SECS = 1;\nlet fullyAuthenticated = false;\n\nws.onopen = function () {\n  log('connected to server');\n  ws.send(\n    JSON.stringify({\n      payloadType: 2100,\n      payload: { clientId, clientSecret },\n    }),\n  );\n  log('requested application authentication');\n};\n\nws.onmessage = function (e) {\n  const serverMsg = JSON.parse(e.data);\n\n  if (serverMsg.payloadType === 2142) {\n    log('server responded with error:', serverMsg.payLoad);\n    return;\n  }\n\n  if (serverMsg.payloadType === 2101) {\n    log('application authentication completed');\n\n    ws.send(\n      JSON.stringify({\n        payloadType: 2102,\n        payload: { ctidTraderAccountId, accessToken },\n      }),\n    );\n    log('requested account authenthication');\n  }\n\n  if (serverMsg.payloadType === 2103) {\n    log('account authentication completed');\n    fullyAuthenticated = true;\n  }\n};\n\nws.onclose = function ({ code, reason, wasClean }) {\n  log('connection closed', { code, reason, wasClean });\n};\n\n(async () => {\n  while (true) {\n    await sleep(0);\n    if (ws.readyState !== WebSocket.OPEN) continue;\n    if (!fullyAuthenticated) continue;\n\n    log('fully authenticated and ready for more communication with the server');\n\n    await sleep(CHECK_INTERVAL_SECS);\n  }\n})();\n"})}),"\n",(0,a.jsx)(e.p,{children:"Results from running the code:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"connected to server\nrequested application authentication\napplication authentication completed\nrequested account authenthication\naccount authentication completed\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\n...\n"})})]})}function l(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(u,{...n})}):u(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>r});var o=t(6540);const a={},c=o.createContext(a);function i(n){const e=o.useContext(c);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:i(n.components),o.createElement(c.Provider,{value:e},n.children)}}}]);