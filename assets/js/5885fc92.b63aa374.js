"use strict";(self.webpackChunkctrader_openapi_docs=self.webpackChunkctrader_openapi_docs||[]).push([[6633],{4336:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"examples/js-connect-place-order-alt","title":"JavaScript example of how to connect to server and place an order (Alt Naming)","description":"Alternative naming for the contents of the Proto files.","source":"@site/docs/06-examples/10-js-connect-place-order-alt.mdx","sourceDirName":"06-examples","slug":"/examples/js-connect-place-order-alt","permalink":"/ctoa/examples/js-connect-place-order-alt","draft":false,"unlisted":false,"editUrl":"https://github.com/m-ahmadi/ctoa/blob/main/docs/06-examples/10-js-connect-place-order-alt.mdx","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"JavaScript example of how to connect to server and place an order","permalink":"/ctoa/examples/js-connect-place-order"},"next":{"title":"Basic WebSocket example in JavaScript","permalink":"/ctoa/examples/js-websocket-basics"}}');var a=t(4848),s=t(8453);const r={},i="JavaScript example of how to connect to server and place an order (Alt Naming)",c={},l=[{value:"How to setup environment",id:"how-to-setup-environment",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"javascript-example-of-how-to-connect-to-server-and-place-an-order-alt-naming",children:"JavaScript example of how to connect to server and place an order (Alt Naming)"})}),"\n",(0,a.jsx)(n.p,{children:"Alternative naming for the contents of the Proto files."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"var credentials = require('./credentials.json');\nvar oa = require('./OAModel.custom.json');\nvar pt = require('./payloadTypes.custom.json');\nvar fs = require('fs');\nuid = (\n  (i) => () =>\n    'cm_id_' + i++\n)(1);\n\n// put two frequently needed credentials into variables\nvar { accountId: ctidTraderAccountId, accessToken } = credentials;\n\n// initialize websocket\nvar ws = new WebSocket('wss://live.ctraderapi.com:5036'); // or 'demo.ctraderapi.com:5036'\n\n// main function which is called after successful authentication\nfunction main() {\n  console.log('ready to do something');\n\n  // request symbols list\n  var clientMsg = {\n    clientMsgId: uid(),\n    payloadType: pt.req.SymbolsList,\n    payload: {\n      ctidTraderAccountId,\n      accessToken,\n      includeArchivedSymbols: false,\n    },\n  };\n  ws.send(JSON.stringify(clientMsg));\n\n  // place order\n  var clientMsg = {\n    clientMsgId: uid(),\n    payloadType: pt.req.NewOrder,\n    payload: {\n      ctidTraderAccountId,\n      accessToken,\n      orderType: oa.OrderType.LIMIT,\n      tradeSide: oa.TradeSide.BUY,\n      symbolId: 41, // XAUUSD\n      limitPrice: 2700.34,\n      volume: 100, // equals 0.01 lot\n      stopLoss: 2600.34,\n      takeProfit: 2750.34,\n    },\n  };\n  ws.send(JSON.stringify(clientMsg));\n}\n\n// main callback\nfunction onResp(message) {\n  var { payloadType, payload } = message;\n\n  if (payloadType === pt.res.SymbolsList) {\n    var syms = payload.symbol;\n    fs.writeFileSync('syms.json', JSON.stringify(syms, null, 2));\n    console.log('got the symbol list and saved it as syms.json');\n  }\n\n  if (payloadType === pt.event.Execution) {\n    console.log('placed order successfully');\n    console.log('order id:', payload.order.orderId);\n  }\n}\n\n// setting up event listeners for the WebSocket instance\n\nws.onopen = function (e) {\n  console.log('connected');\n\n  // first thing after connecting is to request for app auth\n  var clientMsg = {\n    clientMsgId: uid(),\n    payloadType: pt.req.ApplicationAuth,\n    payload: {\n      clientId: credentials.clientId,\n      clientSecret: credentials.clientSecret,\n    },\n  };\n  ws.send(JSON.stringify(clientMsg));\n};\n\nws.onmessage = function (e) {\n  var serverMsg = JSON.parse(e.data);\n  var { payloadType } = serverMsg;\n\n  // apply custom logic on special server messages (i.e. auth results, errors, heartbeat events)\n\n  if (payloadType === pt.res.ApplicationAuth) {\n    console.log('app auth done');\n    // now must request for account auth\n    var clientMsg = {\n      clientMsgId: uid(),\n      payloadType: pt.req.AccountAuth,\n      payload: { ctidTraderAccountId, accessToken },\n    };\n    ws.send(JSON.stringify(clientMsg));\n    return;\n  }\n\n  if (payloadType === pt.res.AccountAuth) {\n    console.log('account auth done');\n    // now everything is ready to do something\n    main();\n    return;\n  }\n\n  if (payloadType === pt.res.Error) {\n    console.log('server sent error message', serverMsg.payload);\n    return;\n  }\n\n  if (payloadType === pt.common.Heartbeat) {\n    console.log('heartbeat event');\n    return;\n  }\n\n  // direct any other server messages to some other function\n  onResp(serverMsg);\n};\n\nws.onerror = function (e) {\n  console.log('websocket error', e);\n};\n\nws.onclose = function (e) {\n  console.log('disconnected', e.code, e.reason, e.wasClean);\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"how-to-setup-environment",children:"How to setup environment"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import ctrader_open_api.messages.OpenApiModelMessages_pb2 as OAModel\nimport json\n\n# get OAModel in custom format\n# we're deleting \"PayloadType\" since we're getting it separately\ntarget_keys = filter(lambda i: i.startswith('ProtoOA'), dir(OAModel))\nones_with_keyval = filter(lambda k: hasattr(getattr(OAModel,k),'keys'), target_keys)\nout = {}\nfor key in ones_with_keyval:\n  prop = getattr(OAModel, key)\n  name = key.split('ProtoOA')[1]\n  out[name] = dict(zip(prop.keys(), prop.values()))\ndel out['PayloadType']\nwith open('OAModel.custom.json', 'w', encoding='utf-8') as f:\n  json.dump(out, f, ensure_ascii=False, indent=2)\n\n\n# get payloadTypes in custom format\nexcp = {'SLTP':'SLTP', 'PNL':'PnL'}\nout = {'req': {}, 'res': {}, 'event': {}}\nfor key, val in OAModel.ProtoOAPayloadType.items():\n  parts = key.split('PROTO_OA_')[1].split('_')\n  type = parts[-1].lower()\n  name = ''.join([excp[i] if i in excp else i.title() for i in parts[:-1]]) # PascalCase (proper)\n  # name = ''.join(map(str.title, parts[:-1]))  # PascalCase (naive)\n  # name = '_'.join(parts[:-1])                 # UPPER_SNAKE_CASE\n  # name = '_'.join(map(str.lower, parts[:-1])) # snake_case\n  out[type][name] = val\nout['common'] = {'Message': 5, 'ErrorRes': 50, 'HeartbeatEvent': 51}\nwith open('payloadTypes.custom.json', 'w', encoding='utf-8') as f:\n  json.dump(out, f, ensure_ascii=False, indent=2)\n\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var o=t(6540);const a={},s=o.createContext(a);function r(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);