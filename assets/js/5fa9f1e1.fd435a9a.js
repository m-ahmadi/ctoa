"use strict";(self.webpackChunkctrader_openapi_docs=self.webpackChunkctrader_openapi_docs||[]).push([[509],{580:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>p,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"contacting-api/protobuf/compilation-of-proto-files","title":"Compilation of .proto Files","description":"Now that we have installed the compiler and runtime, we can start compiling the","source":"@site/docs/02-contacting-api/09-protobuf/02-compilation-of-proto-files.mdx","sourceDirName":"02-contacting-api/09-protobuf","slug":"/contacting-api/protobuf/compilation-of-proto-files","permalink":"/ctoa/contacting-api/protobuf/compilation-of-proto-files","draft":false,"unlisted":false,"editUrl":"https://github.com/m-ahmadi/ctoa/blob/main/docs/02-contacting-api/09-protobuf/02-compilation-of-proto-files.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"Compiler and Runtime","permalink":"/ctoa/contacting-api/protobuf/compiler-and-runtime"},"next":{"title":"Contacting API with Protobuf","permalink":"/ctoa/contacting-api/protobuf/contacting-api-with-protobuf"}}');var i=o(4848),s=o(8453),a=o(5537),r=o(9329);const l={},p="Compilation of .proto Files",c={},d=[{value:"Getting <code>.proto</code> Files",id:"getting-proto-files",level:2},{value:"Compile <code>.proto</code> Files",id:"compile-proto-files",level:2},{value:"Main Compiler",id:"main-compiler",level:3},{value:"JavaScript-Specific Compiler",id:"javascript-specific-compiler",level:3},{value:"Using Pre-Compiled <code>.proto</code> files from Official Python Package",id:"using-pre-compiled-proto-files-from-official-python-package",level:2},{value:"Convert to JSON",id:"convert-to-json",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"compilation-of-proto-files",children:["Compilation of ",(0,i.jsx)(n.code,{children:".proto"})," Files"]})}),"\n",(0,i.jsxs)(n.p,{children:["Now that we have installed the compiler and runtime, we can start compiling the\n",(0,i.jsx)(n.code,{children:".proto"})," files. So where are these ",(0,i.jsx)(n.code,{children:".proto"})," files anyway?"]}),"\n",(0,i.jsxs)(n.h2,{id:"getting-proto-files",children:["Getting ",(0,i.jsx)(n.code,{children:".proto"})," Files"]}),"\n",(0,i.jsxs)(n.p,{children:["The cTrader OpenAPI publishes its ",(0,i.jsx)(n.code,{children:".proto"})," files in the following GitHub\nrepository:"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://github.com/spotware/openapi-proto-messages",children:"https://github.com/spotware/openapi-proto-messages"})}),"\n",(0,i.jsx)(n.p,{children:"Let's get a copy of them:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"git clone https://github.com/spotware/openapi-proto-messages\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["if you don't have ",(0,i.jsx)(n.a,{href:"https://git-scm.com/downloads",children:(0,i.jsx)(n.code,{children:"git"})})," installed on your\nsystem, you can download them manually by going into the page and click the\n",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"<> Code"})})," button, and then the ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"Download ZIP"})})," button."]})}),"\n",(0,i.jsxs)(n.p,{children:["Now that we have the ",(0,i.jsx)(n.code,{children:".proto"})," files in a directory named\n",(0,i.jsx)(n.code,{children:"openapi-proto-messages"}),", it's time to compile them."]}),"\n",(0,i.jsxs)(n.h2,{id:"compile-proto-files",children:["Compile ",(0,i.jsx)(n.code,{children:".proto"})," Files"]}),"\n",(0,i.jsx)(n.h3,{id:"main-compiler",children:"Main Compiler"}),"\n",(0,i.jsxs)(a.A,{children:[(0,i.jsx)(r.A,{value:"Windows",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protoc --proto_path=openapi-proto-messages --python_out=./ ^\n  OpenApiMessages.proto ^\n  OpenApiModelMessages.proto ^\n  OpenApiCommonMessages.proto ^\n  OpenApiCommonModelMessages.proto\n"})})}),(0,i.jsx)(r.A,{value:"Linux",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protoc --proto_path=openapi-proto-messages --python_out=./ \\\n  OpenApiMessages.proto \\\n  OpenApiModelMessages.proto \\\n  OpenApiCommonMessages.proto \\\n  OpenApiCommonModelMessages.proto\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"Now we have the below compiled files:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"OpenApiMessages_pb2.py\nOpenApiModelMessages_pb2.py\nOpenApiCommonMessages_pb2.py\nOpenApiCommonModelMessages_pb2.py\n"})}),"\n",(0,i.jsx)(n.p,{children:"Which we will import in our Python code like below:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:"import OpenApiMessages_pb2.py as OA\nimport OpenApiModelMessages_pb2.py as OAModel\nimport OpenApiCommonMessages_pb2.py as OACommon\nimport OpenApiCommonModelMessages_pb2.py as OACommonModel\n"})}),"\n",(0,i.jsx)(n.h3,{id:"javascript-specific-compiler",children:"JavaScript-Specific Compiler"}),"\n",(0,i.jsxs)(a.A,{children:[(0,i.jsx)(r.A,{value:"Windows",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd openapi-proto-messages\n\npbjs -t json-module -o ../pb.compiled.js --no-beautify --no-comments ^\n  OpenApiMessages.proto ^\n  OpenApiModelMessages.proto ^\n  OpenApiCommonMessages.proto ^\n  OpenApiCommonModelMessages.proto\n"})})}),(0,i.jsx)(r.A,{value:"Linux",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cd openapi-proto-messages\n\npbjs -t json-module -o ../pb.compiled.js --no-beautify --no-comments \\\n  OpenApiMessages.proto \\\n  OpenApiModelMessages.proto \\\n  OpenApiCommonMessages.proto \\\n  OpenApiCommonModelMessages.proto\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"In the case of JavaScript, we will have one single file as the output of\ncompilation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pb.compiled.js\n"})}),"\n",(0,i.jsx)(n.p,{children:"Which we will import in our Node.js code like below:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"var pb = require('./pb.compiled.js');\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"using-pre-compiled-proto-files-from-official-python-package",children:["Using Pre-Compiled ",(0,i.jsx)(n.code,{children:".proto"})," files from Official Python Package"]}),"\n",(0,i.jsxs)(n.p,{children:["There is another way to use the compiled ",(0,i.jsx)(n.code,{children:".proto"})," files without actually\ncompiling them ourselves, and that is through using the\n",(0,i.jsx)(n.a,{href:"https://pypi.org/project/ctrader_open_api/",children:"cTrader OpenAPI Official Python Package"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["There is also another way to get to use already compiled ",(0,i.jsx)(n.code,{children:".proto"})," files which\nexist in the\n",(0,i.jsx)(n.a,{href:"https://pypi.org/project/ctrader_open_api/",children:"official Python package"}),". Since\nthis way we can skip the compilation step, it's worth mentioning. Keep in mind\nwe still need the runtime in this approach, but we only skip that step because\nwhen we install the official Python package, the runtime is installed with it\n(because the runtime is a dependency of it)."]}),"\n",(0,i.jsx)(n.p,{children:"So let's create a python virtual environment for an isolated environment and\nactivate it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"python -m venv .env\n./env/Scripts/activate\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now let's see what packages we have at this point:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pip list\n# Package    Version\n# ---------- -------\n# pip        21.2.3\n# setuptools 57.4.0\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now we will intsall the offical cTrader Python package, and after it's done, we\nwill check again to see what packages were installed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"pip install ctrader_open_api\npip list\n"})}),"\n",(0,i.jsx)(n.p,{children:"Which will output a (somewhat) long list of packages that were just installed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Package             Version\n------------------- --------\n...\n...\nprotobuf            3.20.1\n...\n...\n"})}),"\n",(0,i.jsx)(n.p,{children:"And there it is, that is the runtime being installed when you install the\nofficial Python package, and you can see that its version is much older that the\nruntime we installed ourself."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["When you have an older runtime like here, it can't load ",(0,i.jsx)(n.code,{children:".proto"})," files compiled\nwith a new compiler. Yes, we're not complining anything here, and that was the\nwhole point of this section, but hypothetically, if we did, it would be an\nexample of Cross-Version runtime that was\n",(0,i.jsx)(n.a,{href:"./compiler-and-runtime#compiler-and-runtime-versions",children:"mentioned earlier"}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:["After we install the official package, we can access the already compiled\n",(0,i.jsx)(n.code,{children:".proto"})," files like below:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:"import ctrader_open_api.messages.OpenApiMessages_pb2 as OA\nimport ctrader_open_api.messages.OpenApiModelMessages_pb2 as OAModel\nimport ctrader_open_api.messages.OpenApiCommonMessages_pb2 as OACommon\nimport ctrader_open_api.messages.OpenApiCommonModelMessages_pb2 as OAModelCommon\n"})}),"\n",(0,i.jsx)(n.h3,{id:"convert-to-json",children:"Convert to JSON"}),"\n",(0,i.jsxs)(n.p,{children:["As you might have guessed, this approach of using official Python package to\nskip the compilation step can be considered a solution if you're using Python,\nbut what about another programming language? In that case, we can extract the\ninformation in ",(0,i.jsx)(n.code,{children:".proto"})," files and export it into a ",(0,i.jsx)(n.code,{children:"JSON"})," format. Altough not an\nelegant solution, but still has some value due to it being easy and not needing\nthe compilation step. (For example in a case where you just want to test\nsomething)."]}),"\n",(0,i.jsx)(n.p,{children:"Below is an example of doing so:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:"import ctrader_open_api.messages.OpenApiModelMessages_pb2 as OAModel\nimport json\n\n# get payloadTypes\ntarget_keys = filter(lambda i: i.startswith('PROTO_OA_'), dir(OAModel))\nout = dict(map(lambda k: [k, getattr(OAModel, k)], target_keys))\nout['PROTO_PROTO_MESSAGE' = 5;\nout['PROTO_ERROR_RES' = 50;\nout['PROTO_HEARTBEAT_EVENT' = 51;\nwith open('payloadTypes.json', 'w', encoding='utf-8') as f:\n  json.dump(out, f, ensure_ascii=False, indent=2)\n\n# get OAModel stuff\ntarget_keys = filter(lambda i: i.startswith('ProtoOA'), dir(OAModel))\nones_with_keyval = filter(lambda k: hasattr(getattr(OAModel,k),'keys'), target_keys)\nout = {}\nfor key in ones_with_keyval:\n  prop = getattr(OAModel, key)\n  out[key] = dict(zip(prop.keys(), prop.values()))\nwith open('OAModel.json', 'w', encoding='utf-8') as f:\n  json.dump(out, f, ensure_ascii=False, indent=2)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Keep in mind, in this approach, the naming of the messages change from\n",(0,i.jsx)(n.code,{children:"PascalCase"})," to ",(0,i.jsx)(n.code,{children:"UPPER_SNAKE_CASE"})," (aka ",(0,i.jsx)(n.code,{children:"SCREAMING_SNAKE_CASE"}),"), unless you\nmodify the code otherwise."]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},5537:(e,n,o)=>{o.d(n,{A:()=>v});var t=o(6540),i=o(4164),s=o(5627),a=o(6347),r=o(372),l=o(604),p=o(1861),c=o(8749);function d(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:o}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return d(e).map(({props:{value:e,label:n,attributes:o,default:t}})=>({value:e,label:n,attributes:o,default:t}))}(o);return function(e){const n=(0,p.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,o])}function u({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const o=(0,a.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(i),(0,t.useCallback)(e=>{if(!i)return;const n=new URLSearchParams(o.location.search);n.set(i,e),o.replace({...o.location,search:n.toString()})},[i,o])]}function f(e){const{defaultValue:n,queryString:o=!1,groupId:i}=e,s=h(e),[a,l]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!u({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const o=n.find(e=>e.default)??n[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:s})),[p,d]=m({queryString:o,groupId:i}),[f,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[o,i]=(0,c.Dv)(n);return[o,(0,t.useCallback)(e=>{n&&i.set(e)},[n,i])]}({groupId:i}),j=(()=>{const e=p??f;return u({value:e,tabValues:s})?e:null})();(0,r.A)(()=>{j&&l(j)},[j]);return{selectedValue:a,selectValue:(0,t.useCallback)(e=>{if(!u({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),g(e)},[d,g,s]),tabValues:s}}var g=o(9136);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=o(4848);function x({className:e,block:n,selectedValue:o,selectValue:t,tabValues:a}){const r=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),p=e=>{const n=e.currentTarget,i=r.indexOf(n),s=a[i].value;s!==o&&(l(n),t(s))},c=e=>{let n=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const o=r.indexOf(e.currentTarget)+1;n=r[o]??r[0];break}case"ArrowLeft":{const o=r.indexOf(e.currentTarget)-1;n=r[o]??r[r.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:a.map(({value:e,label:n,attributes:t})=>(0,b.jsx)("li",{role:"tab",tabIndex:o===e?0:-1,"aria-selected":o===e,ref:e=>{r.push(e)},onKeyDown:c,onClick:p,...t,className:(0,i.A)("tabs__item",j.tabItem,t?.className,{"tabs__item--active":o===e}),children:n??e},e))})}function w({lazy:e,children:n,selectedValue:o}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===o);return e?(0,t.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==o}))})}function y(e){const n=f(e);return(0,b.jsxs)("div",{className:(0,i.A)("tabs-container",j.tabList),children:[(0,b.jsx)(x,{...n,...e}),(0,b.jsx)(w,{...n,...e})]})}function v(e){const n=(0,g.A)();return(0,b.jsx)(y,{...e,children:d(e.children)},String(n))}},8453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>r});var t=o(6540);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}},9329:(e,n,o)=>{o.d(n,{A:()=>a});o(6540);var t=o(4164);const i={tabItem:"tabItem_Ymn6"};var s=o(4848);function a({children:e,hidden:n,className:o}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(i.tabItem,o),hidden:n,children:e})}}}]);