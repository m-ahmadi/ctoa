"use strict";(self.webpackChunkctrader_openapi_docs=self.webpackChunkctrader_openapi_docs||[]).push([[511],{828:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>r,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"contacting-api/authentication","title":"Authentication","description":"First put the credentials we acquired in a file named","source":"@site/docs/03-contacting-api/05-authentication.mdx","sourceDirName":"03-contacting-api","slug":"/contacting-api/authentication","permalink":"/ctoa/contacting-api/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/m-ahmadi/ctoa/blob/main/docs/03-contacting-api/05-authentication.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"Acquiring Credentials","permalink":"/ctoa/contacting-api/acquiring-credentials"},"next":{"title":"Keeping Connection Open","permalink":"/ctoa/contacting-api/keeping-connection-open"}}');var i=t(4848),c=t(8453);const o={},s="Authentication",r={},l=[{value:"Application Authentication",id:"application-authentication",level:2},{value:"Application and Account Authentication",id:"application-and-account-authentication",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,i.jsxs)(e.p,{children:["First put the ",(0,i.jsx)(e.a,{href:"./acquiring-credentials",children:"credentials we acquired"})," in a file named\n",(0,i.jsx)(e.code,{children:"credentials.json"})," for example."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-json",children:'{\n  "accountId": 12345678,\n  "clientId": "",\n  "clientSecret": "",\n  "accessToken": "",\n  "refreshToken": ""\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"application-authentication",children:"Application Authentication"}),"\n",(0,i.jsx)(e.p,{children:"The only messages that you can send to server without application\nauthenthication are:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://help.ctrader.com/open-api/messages/#protooaapplicationauthreq",children:(0,i.jsx)(e.code,{children:"ApplicationAuth"})})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://help.ctrader.com/open-api/messages/#protooarefreshtokenreq",children:(0,i.jsx)(e.code,{children:"RefreshToken"})})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://help.ctrader.com/open-api/messages/#protooaversionreq",children:(0,i.jsx)(e.code,{children:"Version"})})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"const { clientId, clientSecret } = require('./credentials.json');\n\nconst ws = new WebSocket('wss://live.ctraderapi.com:5036');\n\n// util functions\nconst { log } = console;\nconst sleep = (secs) => new Promise((r) => setTimeout(r, secs * 1000));\n\nconst CHECK_INTERVAL_SECS = 1;\nlet appAuthenticated = false;\n\nws.onopen = function () {\n  log('connected to server');\n  ws.send(\n    JSON.stringify({\n      payloadType: 2100,\n      payload: { clientId, clientSecret },\n    }),\n  );\n  log('requested application authentication');\n};\n\nws.onmessage = function (e) {\n  const serverMsg = JSON.parse(e.data);\n\n  if (serverMsg.payloadType === 2142) {\n    log('server responded with error:', serverMsg.payLoad);\n    return;\n  }\n\n  if (serverMsg.payloadType === 2101) {\n    log('application authentication completed');\n    appAuthenticated = true;\n  }\n};\n\nws.onclose = function ({ code, reason, wasClean }) {\n  log('connection closed', { code, reason, wasClean });\n};\n\n(async () => {\n  while (true) {\n    await sleep(0);\n    if (ws.readyState !== WebSocket.OPEN) continue;\n    if (!appAuthenticated) continue;\n\n    log('partially authenticated');\n\n    await sleep(CHECK_INTERVAL_SECS);\n  }\n})();\n"})}),"\n",(0,i.jsx)(e.h2,{id:"application-and-account-authentication",children:"Application and Account Authentication"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"const {\n  clientId,\n  clientSecret,\n  accountId: ctidTraderAccountId,\n  accessToken,\n} = require('./credentials.json');\n\nconst ws = new WebSocket('wss://live.ctraderapi.com:5036');\n\n// util functions\nconst { log } = console;\nconst sleep = (secs) => new Promise((r) => setTimeout(r, secs * 1000));\n\nconst CHECK_INTERVAL_SECS = 1;\nlet fullyAuthenticated = false;\n\nws.onopen = function () {\n  log('connected to server');\n  ws.send(\n    JSON.stringify({\n      payloadType: 2100,\n      payload: { clientId, clientSecret },\n    }),\n  );\n  log('requested application authentication');\n};\n\nws.onmessage = function (e) {\n  const serverMsg = JSON.parse(e.data);\n\n  if (serverMsg.payloadType === 2142) {\n    log('server responded with error:', serverMsg.payLoad);\n    return;\n  }\n\n  if (serverMsg.payloadType === 2101) {\n    log('application authentication completed');\n\n    ws.send(\n      JSON.stringify({\n        payloadType: 2102,\n        payload: { ctidTraderAccountId, accessToken },\n      }),\n    );\n    log('requested account authenthication');\n  }\n\n  if (serverMsg.payloadType === 2103) {\n    log('account authentication completed');\n    fullyAuthenticated = true;\n  }\n};\n\nws.onclose = function ({ code, reason, wasClean }) {\n  log('connection closed', { code, reason, wasClean });\n};\n\n(async () => {\n  while (true) {\n    await sleep(0);\n    if (ws.readyState !== WebSocket.OPEN) continue;\n    if (!fullyAuthenticated) continue;\n\n    log('fully authenticated and ready for more communication with the server');\n\n    await sleep(CHECK_INTERVAL_SECS);\n  }\n})();\n"})}),"\n",(0,i.jsx)(e.p,{children:"Results from running the code:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"connected to server\nrequested application authentication\napplication authentication completed\nrequested account authenthication\naccount authentication completed\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\n...\n"})})]})}function p(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>o,x:()=>s});var a=t(6540);const i={},c=a.createContext(i);function o(n){const e=a.useContext(c);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),a.createElement(c.Provider,{value:e},n.children)}}}]);