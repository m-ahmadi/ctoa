"use strict";(self.webpackChunkctrader_openapi_docs=self.webpackChunkctrader_openapi_docs||[]).push([[5511],{828:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"contacting-api/authentication","title":"Authentication","description":"First put the credentials we acquired in a file named","source":"@site/docs/03-contacting-api/05-authentication.mdx","sourceDirName":"03-contacting-api","slug":"/contacting-api/authentication","permalink":"/ctoa/contacting-api/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/m-ahmadi/ctoa/blob/main/docs/03-contacting-api/05-authentication.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"Acquiring Credentials","permalink":"/ctoa/contacting-api/acquiring-credentials"},"next":{"title":"Keeping Connection Open","permalink":"/ctoa/contacting-api/keeping-connection-open"}}');var i=t(4848),r=t(8453),c=t(5537),o=t(9329);const s={},l="Authentication",u={},d=[{value:"Application Authentication",id:"application-authentication",level:2},{value:"Application and Account Authentication",id:"application-and-account-authentication",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,i.jsxs)(n.p,{children:["First put the ",(0,i.jsx)(n.a,{href:"./acquiring-credentials",children:"credentials we acquired"})," in a file named\n",(0,i.jsx)(n.code,{children:"credentials.json"})," for example."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "accountId": 12345678,\n  "clientId": "",\n  "clientSecret": "",\n  "accessToken": "",\n  "refreshToken": ""\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"application-authentication",children:"Application Authentication"}),"\n",(0,i.jsx)(n.p,{children:"The only messages that you can send to server without application\nauthenthication are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://help.ctrader.com/open-api/messages/#protooaapplicationauthreq",children:(0,i.jsx)(n.code,{children:"ApplicationAuth"})})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://help.ctrader.com/open-api/messages/#protooarefreshtokenreq",children:(0,i.jsx)(n.code,{children:"RefreshToken"})})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://help.ctrader.com/open-api/messages/#protooaversionreq",children:(0,i.jsx)(n.code,{children:"Version"})})}),"\n"]}),"\n",(0,i.jsxs)(c.A,{children:[(0,i.jsx)(o.A,{value:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const { clientId, clientSecret } = require('./credentials.json');\n\nconst ws = new WebSocket('wss://live.ctraderapi.com:5036');\n\n// util functions\nconst { log } = console;\nconst sleep = (secs) => new Promise((r) => setTimeout(r, secs * 1000));\n\nconst CHECK_INTERVAL_SECS = 1;\nlet appAuthenticated = false;\n\nws.onopen = function () {\n  log('connected to server');\n  ws.send(\n    JSON.stringify({\n      payloadType: 2100,\n      payload: { clientId, clientSecret },\n    }),\n  );\n  log('requested application authentication');\n};\n\nws.onmessage = function (e) {\n  const serverMsg = JSON.parse(e.data);\n\n  if (serverMsg.payloadType === 2142) {\n    log('server responded with error:', serverMsg.payLoad);\n    return;\n  }\n\n  if (serverMsg.payloadType === 2101) {\n    log('application authentication completed');\n    appAuthenticated = true;\n  }\n};\n\nws.onclose = function ({ code, reason, wasClean }) {\n  log('connection closed', { code, reason, wasClean });\n};\n\n(async () => {\n  while (true) {\n    await sleep(0);\n    if (ws.readyState !== WebSocket.OPEN) continue;\n    if (!appAuthenticated) continue;\n\n    log('partially authenticated');\n\n    await sleep(CHECK_INTERVAL_SECS);\n  }\n})();\n"})})}),(0,i.jsx)(o.A,{value:"Python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:"import json\nimport asyncio as aio\nfrom websockets.asyncio.client import connect # pip install websockets\n\ncreds = json.load(open('./credentials.json'))\n\nasync def main():\n  async with connect('wss://live.ctraderapi.com:5036') as ws:\n    print('connected to server')\n\n    client_msg = {\n      'payloadType': 2100,\n      'payload': {\n        'clientId': creds['clientId'],\n        'clientSecret': creds['clientSecret']\n      }\n    }\n\n    print('requested application authentication')\n    await ws.send(json.dumps(client_msg))\n\n    server_msg = json.loads(await ws.recv())\n\n    if server_msg['payloadType'] != 2101:\n      raise Exception('application authentication failed')\n\n    print('application authentication completed')\n\n\n    print('partially authenticated')\n\naio.run(main())\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"Results from running the code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"connected to server\nrequested application authentication\napplication authentication completed\npartially authenticated\n"})}),"\n",(0,i.jsx)(n.h2,{id:"application-and-account-authentication",children:"Application and Account Authentication"}),"\n",(0,i.jsxs)(c.A,{children:[(0,i.jsx)(o.A,{value:"JavaScript",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const {\n  clientId,\n  clientSecret,\n  accountId: ctidTraderAccountId,\n  accessToken,\n} = require('./credentials.json');\n\nconst ws = new WebSocket('wss://live.ctraderapi.com:5036');\n\n// util functions\nconst { log } = console;\nconst sleep = (secs) => new Promise((r) => setTimeout(r, secs * 1000));\n\nconst CHECK_INTERVAL_SECS = 1;\nlet fullyAuthenticated = false;\n\nws.onopen = function () {\n  log('connected to server');\n  ws.send(\n    JSON.stringify({\n      payloadType: 2100,\n      payload: { clientId, clientSecret },\n    }),\n  );\n  log('requested application authentication');\n};\n\nws.onmessage = function (e) {\n  const serverMsg = JSON.parse(e.data);\n\n  if (serverMsg.payloadType === 2142) {\n    log('server responded with error:', serverMsg.payLoad);\n    return;\n  }\n\n  if (serverMsg.payloadType === 2101) {\n    log('application authentication completed');\n\n    ws.send(\n      JSON.stringify({\n        payloadType: 2102,\n        payload: { ctidTraderAccountId, accessToken },\n      }),\n    );\n    log('requested account authentication');\n  }\n\n  if (serverMsg.payloadType === 2103) {\n    log('account authentication completed');\n    fullyAuthenticated = true;\n  }\n};\n\nws.onclose = function ({ code, reason, wasClean }) {\n  log('connection closed', { code, reason, wasClean });\n};\n\n(async () => {\n  while (true) {\n    await sleep(0);\n    if (ws.readyState !== WebSocket.OPEN) continue;\n    if (!fullyAuthenticated) continue;\n\n    log('fully authenticated and ready for more communication with the server');\n\n    await sleep(CHECK_INTERVAL_SECS);\n  }\n})();\n"})})}),(0,i.jsx)(o.A,{value:"Python",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",children:"import json\nimport asyncio as aio\nfrom websockets.asyncio.client import connect # pip install websockets\n\ncreds = json.load(open('./credentials.json'))\n\nasync def main():\n  async with connect('wss://live.ctraderapi.com:5036') as ws:\n    print('connected to server')\n\n    # app auth\n    client_msg = {\n      'payloadType': 2100,\n      'payload': {\n        'clientId': creds['clientId'],\n        'clientSecret': creds['clientSecret']\n      }\n    }\n    print('requested application authentication')\n    await ws.send(json.dumps(client_msg))\n    server_msg = json.loads(await ws.recv())\n    if server_msg['payloadType'] != 2101:\n      raise Exception('application authentication failed')\n    print('application authentication completed')\n\n    # account auth\n    client_msg = {\n      'payloadType': 2102,\n      'payload': {\n        'ctidTraderAccountId': creds['accountId'],\n        'accessToken': creds['accessToken'],\n      }\n    }\n    await ws.send(json.dumps(client_msg))\n    print('requested account authentication')\n    server_msg = json.loads(await ws.recv())\n    if server_msg['payloadType'] != 2103:\n      raise Exception('account authentication failed')\n    print('account authentication completed')\n\n\n    print('fully authenticated and ready for more communication with the server')\n\naio.run(main())\n"})})})]}),"\n",(0,i.jsx)(n.p,{children:"Results from running the code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"connected to server\nrequested application authentication\napplication authentication completed\nrequested account authenthication\naccount authentication completed\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\nfully authenticated and ready for more communication with the server\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},5537:(e,n,t)=>{t.d(n,{A:()=>x});var a=t(6540),i=t(4164),r=t(5627),c=t(6347),o=t(372),s=t(604),l=t(1861),u=t(8749);function d(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,a.useMemo)(()=>{const e=n??function(e){return d(e).map(({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a}))}(t);return function(e){const n=(0,l.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function h({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const t=(0,c.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,s.aZ)(i),(0,a.useCallback)(e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})},[i,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,r=p(e),[c,s]=(0,a.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!h({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r})),[l,d]=m({queryString:t,groupId:i}),[f,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,u.Dv)(n);return[t,(0,a.useCallback)(e=>{n&&i.set(e)},[n,i])]}({groupId:i}),y=(()=>{const e=l??f;return h({value:e,tabValues:r})?e:null})();(0,o.A)(()=>{y&&s(y)},[y]);return{selectedValue:c,selectValue:(0,a.useCallback)(e=>{if(!h({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),d(e),g(e)},[d,g,r]),tabValues:r}}var g=t(9136);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=t(4848);function w({className:e,block:n,selectedValue:t,selectValue:a,tabValues:c}){const o=[],{blockElementScrollPositionUntilNextRender:s}=(0,r.a_)(),l=e=>{const n=e.currentTarget,i=o.indexOf(n),r=c[i].value;r!==t&&(s(n),a(r))},u=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:c.map(({value:e,label:n,attributes:a})=>(0,v.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:u,onClick:l,...a,className:(0,i.A)("tabs__item",y.tabItem,a?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function b({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===t);return e?(0,a.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function j(e){const n=f(e);return(0,v.jsxs)("div",{className:(0,i.A)("tabs-container",y.tabList),children:[(0,v.jsx)(w,{...n,...e}),(0,v.jsx)(b,{...n,...e})]})}function x(e){const n=(0,g.A)();return(0,v.jsx)(j,{...e,children:d(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var a=t(6540);const i={},r=a.createContext(i);function c(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),a.createElement(r.Provider,{value:n},e.children)}},9329:(e,n,t)=>{t.d(n,{A:()=>c});t(6540);var a=t(4164);const i={tabItem:"tabItem_Ymn6"};var r=t(4848);function c({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)(i.tabItem,t),hidden:n,children:e})}}}]);